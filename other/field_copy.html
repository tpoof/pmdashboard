<script>
(function () {
  function findInput(indicatorId) {
    // Common LEAF patterns; keep the first match that exists.
    var candidates = [
      '[data-indicator-id="' + indicatorId + '"] textarea',
      '[data-indicator-id="' + indicatorId + '"] input, [data-indicator-id="' + indicatorId + '"] textarea',
      '#indicator' + indicatorId + ' textarea',
      '#indicator' + indicatorId + ' input, #indicator' + indicatorId + ' textarea'
    ];
    for (var i = 0; i < candidates.length; i++) {
      var el = document.querySelector(candidates[i]);
      if (el) return el;
    }
    return null;
  }

  function copyValue() {
    var from = findInput(1);
    var to = findInput(2);
    if (!from || !to) return;
    to.value = from.value || '';
    // Trigger change/input in case LEAF listens to events
    to.dispatchEvent(new Event('input', { bubbles: true }));
    to.dispatchEvent(new Event('change', { bubbles: true }));
  }

  function init() {
    var from = findInput(1);
    var to = findInput(2);
    if (!from || !to) return;

    // Initial sync
    copyValue();

    // Keep synced on user input or programmatic changes that trigger input/change
    from.addEventListener('input', copyValue);
    from.addEventListener('change', copyValue);
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();

(function () {
  "use strict";

  if (window.__leafAutoReloadAfterSubmitInstalled) return;
  window.__leafAutoReloadAfterSubmitInstalled = true;

  var RELOAD_DELAY_MS = 1200;

  function looksLikeSubmitButton(el) {
    if (!el) return false;
    var tag = (el.tagName || "").toLowerCase();
    if (tag !== "button" && !(tag === "input" && (el.type === "button" || el.type === "submit"))) return false;

    var label = (el.innerText || el.value || "").trim().toLowerCase();
    return label.includes("submit") || label.includes("save");
  }

  function hasObviousErrorUI() {
    // Best-effort selectors for common error patterns
    return Boolean(
      document.querySelector(".alert-danger, .alert-error, .error, .has-error, .text-danger") ||
      Array.from(document.querySelectorAll(".alert, .toast, .notification, .message")).some(function (n) {
        var t = (n.textContent || "").toLowerCase();
        return t.includes("error") || t.includes("failed") || t.includes("invalid");
      })
    );
  }

  function scheduleReload() {
    var startUrl = String(window.location.href);

    setTimeout(function () {
      try {
        // If navigation already happened, do nothing
        if (String(window.location.href) !== startUrl) return;

        // If an error UI is present, do not reload
        if (hasObviousErrorUI()) return;

        window.location.reload();
      } catch (e) {}
    }, RELOAD_DELAY_MS);
  }

  // Capture very early, before app code runs
  document.addEventListener(
    "pointerdown",
    function (e) {
      var btn = e.target && e.target.closest ? e.target.closest("button, input[type='button'], input[type='submit']") : null;
      if (looksLikeSubmitButton(btn)) scheduleReload();
    },
    true
  );

  document.addEventListener(
    "click",
    function (e) {
      var btn = e.target && e.target.closest ? e.target.closest("button, input[type='button'], input[type='submit']") : null;
      if (looksLikeSubmitButton(btn)) scheduleReload();
    },
    true
  );
})();
</script>
